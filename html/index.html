<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalplanung - Advanced Layout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        /* Define consistent variables for easy theme changes */
        :root {
            --row-height: 55px;         /* Height of each person's row */
            --header-height: 60px;      /* Total height of the 2-level date header */
            --names-width: 220px;       /* Width of the fixed names column */
            --day-width: 50px;          /* Width of a single day cell */
        }

        /* The main layout using CSS Grid for perfect alignment */
        .scheduler-container {
            display: grid;
            height: 85vh; /* Sets a max height to enable internal scrolling */
            grid-template-columns: var(--names-width) 1fr;
            grid-template-rows: var(--header-height) 1fr;
            grid-template-areas:
                "corner header"
                "names  grid";
        }
        .scheduler-corner { grid-area: corner; }
        .scheduler-header-container { grid-area: header; }
        .scheduler-names-container { grid-area: names; }
        .scheduler-grid-container { grid-area: grid; }
        
        /* Highlight weekends for better readability */
        .weekend-highlight {
            background-color: #f8fafc; /* A very light gray for weekend columns */
        }
    </style>
</head>
<body class="bg-gray-100 p-4 antialiased">

    <div class="bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden"
         x-data="scheduler()"
         x-init="init(); $nextTick(() => scrollToToday())">

        <!-- Main Scheduler Layout -->
        <div class="scheduler-container">

            <!-- Top-Left Corner (Fixed) -->
            <div class="scheduler-corner border-r border-b border-gray-200 flex items-center justify-center bg-gray-50">
                 <h3 class="text-lg font-semibold text-gray-800">Personal</h3>
            </div>

            <!-- Timeline Header (Horizontally Scrollable) -->
            <div x-ref="header" class="scheduler-header-container bg-gray-50 border-b border-gray-200 overflow-hidden">
                <div class="relative" :style="`width: ${days.length * getDayWidth()}px; height: 100%`">
                    <!-- Months Row -->
                    <template x-for="month in months" :key="month.name">
                        <div class="absolute top-0 h-8 flex items-center justify-center border-r border-gray-200"
                             :style="`left: ${month.left}px; width: ${month.width}px`">
                            <span class="font-semibold text-sm text-gray-600" x-text="month.name"></span>
                        </div>
                    </template>
                    <!-- Days Row -->
                    <template x-for="(day, index) in days" :key="index">
                        <div class="absolute top-8 text-center text-xs h-7 pt-1"
                             :class="{ 'font-bold text-blue-600 bg-blue-100 rounded-t-lg': day.isToday }"
                             :style="`left: ${index * getDayWidth()}px; width: ${getDayWidth()}px`">
                            <span class="text-gray-500" x-text="day.name.slice(0, 1)"></span>
                            <p class="text-gray-800 font-medium" x-text="day.date.split('.')[0]"></p>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Names Column (Vertically Scrollable) -->
            <div x-ref="names" class="scheduler-names-container bg-white border-r border-gray-200 overflow-hidden">
                <div class="relative">
                    <template x-for="person in persons" :key="person.id">
                        <div class="flex items-center px-4 border-b border-gray-100" :style="`height: ${getRowHeight()}px`">
                            <div>
                                <p class="font-semibold text-sm text-gray-800" x-text="person.name"></p>
                                <p class="text-xs text-gray-500" x-text="person.role"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Main Grid and Events (Scrolls in both directions) -->
            <div x-ref="grid" @scroll="syncScroll($event)" class="scheduler-grid-container overflow-auto">
                <div class="relative" :style="`width: ${days.length * getDayWidth()}px; height: ${persons.length * getRowHeight()}px`">
                    <!-- Grid Cells -->
                    <template x-for="(day, dayIndex) in days" :key="`v-${dayIndex}`">
                         <template x-for="(person, personIndex) in persons" :key="`h-${person.id}`">
                             <div class="absolute border-r border-b border-gray-100"
                                  :class="{'weekend-highlight': day.isWeekend}"
                                  :style="`
                                    left: ${dayIndex * getDayWidth()}px; 
                                    top: ${personIndex * getRowHeight()}px; 
                                    width: ${getDayWidth()}px; 
                                    height: ${getRowHeight()}px`">
                                 <!-- Today Column Marker -->
                                 <template x-if="day.isToday">
                                    <div class="w-full h-full bg-blue-500/10"></div>
                                 </template>
                             </div>
                         </template>
                    </template>

                    <!-- Dummy Events -->
                    <template x-for="(event, index) in events" :key="index">
                        <div class="absolute flex items-center justify-center p-1.5"
                             :style="getEventStyle(event)">
                            <div class="h-full w-full rounded-md text-white text-xs flex items-center px-2 shadow-md hover:opacity-80 transition-opacity" :class="event.color || 'bg-blue-500'">
                                <span class="truncate" x-text="event.name"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

<script>
    function scheduler() {
        return {
            days: [],
            months: [],
            persons: [
                { id: 1, name: 'Max Mustermann', role: 'Projektmanager' },
                { id: 2, name: 'Erika Mustermann', role: 'Entwicklerin' },
                { id: 3, name: 'John Doe', role: 'Designer' },
                { id: 4, name: 'Jane Smith', role: 'QA Testerin' },
                { id: 5, name: 'Peter Jones', role: 'Entwickler' },
                { id: 6, name: 'Maria Garcia', role: 'Frontend-Entwicklerin' },
                { id: 7, name: 'David Wilson', role: 'DevOps Engineer' },
                { id: 8, name: 'Sarah Brown', role: 'Produktmanagerin' },
                { id: 9, name: 'Chris Lee', role: 'Backend-Entwickler' },
                { id: 10, name: 'Anna Schmidt', role: 'UI/UX Designerin' },
                { id: 11, name: 'Tom Taylor', role: 'Datenanalyst' },
                { id: 12, name: 'Laura Martinez', role: 'Scrum Master' },
            ],
            events: [
                { personId: 2, start: '2025-01-15', end: '2025-01-25', name: 'Urlaub', color: 'bg-green-500' },
                { personId: 3, start: '2025-02-10', end: '2025-02-18', name: 'Konferenz in Berlin', color: 'bg-purple-500' },
                { personId: 5, start: '2025-03-05', end: '2025-03-20', name: 'Projekt Alpha', color: 'bg-blue-500' },
                { personId: 1, start: '2025-03-10', end: '2025-04-10', name: 'Q2 Planung', color: 'bg-amber-500' },
                { personId: 4, start: '2025-04-01', end: '2025-04-15', name: 'Testing-Phase 1', color: 'bg-red-500' },
                { personId: 7, start: '2025-06-20', end: '2025-07-10', name: 'Server-Migration', color: 'bg-gray-600' },
                { personId: 8, start: '2025-07-14', end: '2025-07-30', name: 'Q3 Planung', color: 'bg-indigo-500' },
                { personId: 10, start: '2025-08-01', end: '2025-08-15', name: 'Redesign-Workshop', color: 'bg-pink-500' },
                { personId: 9, start: '2025-09-01', end: '2025-09-20', name: 'API-Entwicklung', color: 'bg-sky-600' },
            ],
            
            // --- DYNAMIC GETTERS FOR STYLES ---
            getRowHeight: () => parseInt(getComputedStyle(document.documentElement).getPropertyValue('--row-height')),
            getDayWidth: () => parseInt(getComputedStyle(document.documentElement).getPropertyValue('--day-width')),

            init() {
                const year = 2025;
                const startDate = new Date(year, 0, 1);
                const endDate = new Date(year, 11, 31);
                const today = new Date();
                
                const dayNames = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
                const monthNames = ['Januar', 'Februar', 'MÃ¤rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
                
                let currentDate = new Date(startDate);
                let currentMonth = -1;

                while (currentDate <= endDate) {
                    const dayOfWeek = currentDate.getDay();
                    if (currentDate.getMonth() !== currentMonth) {
                        currentMonth = currentDate.getMonth();
                        const daysInMonth = new Date(year, currentMonth + 1, 0).getDate();
                        this.months.push({
                            name: `${monthNames[currentMonth]} ${year}`,
                            left: this.days.length * this.getDayWidth(),
                            width: daysInMonth * this.getDayWidth(),
                        });
                    }

                    this.days.push({
                        name: dayNames[dayOfWeek],
                        date: currentDate.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' }),
                        iso: currentDate.toISOString().split('T')[0], // YYYY-MM-DD format
                        isToday: currentDate.toDateString() === today.toDateString(),
                        isWeekend: dayOfWeek === 0 || dayOfWeek === 6,
                    });
                    currentDate.setDate(currentDate.getDate() + 1);
                }
            },
            
            // --- SCROLL SYNCHRONIZATION ---
            syncScroll(event) {
                // Sync the header's horizontal scroll with the grid's scroll
                this.$refs.header.scrollLeft = event.target.scrollLeft;
                // Sync the names' vertical scroll with the grid's scroll
                this.$refs.names.scrollTop = event.target.scrollTop;
            },

            scrollToToday() {
                const todayIndex = this.days.findIndex(d => d.isToday);
                if (todayIndex > -1) {
                    // Calculate position to center today's date in the visible grid area
                    const gridWidth = this.$refs.grid.clientWidth;
                    const centeredPosition = (todayIndex * this.getDayWidth()) - (gridWidth / 2) + (this.getDayWidth() / 2);
                    this.$refs.grid.scrollLeft = centeredPosition;
                }
            },

            // --- EVENT POSITIONING LOGIC ---
            getEventStyle(event) {
                const personIndex = this.persons.findIndex(p => p.id === event.personId);
                const startIndex = this.days.findIndex(d => d.iso === event.start);
                const endIndex = this.days.findIndex(d => d.iso === event.end);

                if (personIndex === -1 || startIndex === -1 || endIndex === -1) return { display: 'none' };

                const top = personIndex * this.getRowHeight();
                const left = startIndex * this.getDayWidth();
                const width = (endIndex - startIndex + 1) * this.getDayWidth();
                const height = this.getRowHeight();

                return `top: ${top}px; left: ${left}px; width: ${width}px; height: ${height}px;`;
            }
        }
    }
</script>

</body>
</html>